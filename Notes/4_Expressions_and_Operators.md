# 表达式和运算符

表达式(Expression)是JavaScript中的一个短语，JavaScript解释器将其计算(Evaluate)出一个结果。简单的表达式可以组成复杂表达式。

## 4.1 原始表达式

最简单的表达式是原始表达式(Primary Expression)。原始表达式是表达式的最小单位。JavaScript中的原始表达式包含常量或者直接量、关键字、变量。如：

```javascript
1.23			// literal
true			// reserved word
i				// variable
undefined		// variable
```

## 4.2 对象和数组的初始化表达式

对象和数组的初始化表达式实际上是一个新创建的对象和数组。有时称为对象直接量或者数组直接量。但它们不是原始表达式，它们所含的成员或者元素都是子表达式。

数组初始化表达式是通过一对方括号和其内由逗号隔开的列表构成，其内的元素也可以是数组。如：

```javascript
[]				// empty array
[1, 2]			// 2-elements array
[[1, 2], [2, 3]]
```

JavaScript对数组初始化表达式进行求值时，其元素的初始化表达式会先进行求值。数组直接量中的列表逗号之间的元素可以省略，省略的空值会填充为undefined。元素结尾的单个逗号不会再数组最后添加undefined值。如：

```javascript
var a = [1,,2,];		// [1, undefined, 2] length is 3
var b = [1,2,,];		// [1, 2, undefined] length is 3
```

对象初始化表达式和数组初始化表达式非常类似，只是方括号被花括号代替，且每个子表达式都包含一个属性名和一个冒号作为前缀。如：

```javascript
var p = ( x: 2.3, y:-1.2};
var q = { };
q.x = 2.3; q.y = -1.2;		// q has the same properties as p
```

## 4.3 函数定义表达式

函数定义表达式定义一个JavaScript函数。表达式的值是这个新定义的函数。也称为函数直接量。函数的典型定义方式包含关键字function，跟随其后的是一对圆括号，括号内是一个以逗号分割的列表，列表含有0个或者多个标识符(参数名)，然后再跟随一个由花括号包裹的JavaScript代码段(函数体)，如：

```javascript
var square = function(x) { return x * x; }
```

## 4.4 属性访问表达式

属性访问表达式运算得到一个对象属性或者一个数组元素的值。在JavaScript中有两种方法来访问属性：

		expression.identifier
		expression[expression]

第一种写法表达式指定对象，标识符则指定需要访问的属性的名称。第二种写法方括号内的表达式指定要访问的属性的名称或者代表要访问数组元素的索引。如：

```javascript
var o = {x: 1, y: {z: 3}};
var a = [o, 4, [5, 6]];
o.x							// 1
o.y.z						// 3
o['x']						// 1
a[1]						// 4
a[2]["1"]					// 6
a[o].x						// 1
```

在`.`和`[`之前的表达式总是会首先计算。如果结果是null或者undefined，表达式将抛出一个类型错误异常，因为这两个属性不能包含任意属性。如果结果不是对象，则JavaScript会将其转换为对象。如果对象表达式之后跟随句点和标识符，则会查找由这个标识符所指定的属性的值，并将其作为整个表达式的值返回。如果对象表达式后跟随一对方括号，则会计算方括号的表达式的值并将它转换为字符串。如果命名的属性不存在，那么整个属性访问表达式的值就是undefined。

## 4.5 调用表达式

JavaScript中调用表达式(Invocation expression)是一种调用(或者执行)函数或者方法的语法表示。它以一个函数表达式开始，这个函数表达式指定了要调用的函数。函数表达式后跟随一对圆括号，括号内是一个以逗号隔开的参数列表，参数可以有0个也可以有多个。如：

```javascript
f(0);
Math.max(x, y, z);
a.sort()
```

当对调用表达式进行求值时，首先计算函数表达式，然后计算参数表达式。如果函数表达式的值不是一个可调用的对象，则抛出一个类型错误异常。然后，实参的值被依次赋值给形参，这些形参是定义函数时指定的，接下来开始执行函数体，如果函数使用return语句给出一个返回值，那么这个值就是整个调用表达式的值。否则，调用表达式的值就是undefined。

任何一个调用表达式都包含一对圆括号和左圆括号之前的表达式。如果这个表达式是一个属性访问表达式，那么这个调用称作方法调用(Method Invocation)。方法调用中使用this指向当前对象(该方法所属对象)。如果不是方法调用，this的值为undefined。

## 4.6 对象创建表达式

对象创建表达式(Object Creation Expression)创建一个对象并调用一个函数(构造函数)初始化新对象的属性。语法如下：

```javascript
new Object();
new Object;
new Object(1, 2);
```

如果一个对象创建表达式不需要传入任何参数给构造函数，则括号可以省略。当计算一个对象创建表达式的值时，和对象初始化表达式通过{}创建对象的做法一样，JavaScript首先创建一个新的空对象，然后，JavaScript通过传入指定的参数并将这个新对象当做this的值来调用指定的函数。

## 4.7 运算符概述

JavaScript中的运算符用于算术表达式、比较表达式、逻辑表达式、赋值表达式等。如下按照运算符的优先级列出JavaScript中的运算符。

运算符 | 操作 | A | N | 类型
--- | --- | --- | --- | ---
++<br />--<br />-<br />+<br />~<br />!<br />delete<br />typeof<br />void | 前/后增量<br />前/后减量<br />求反<br />转换为数字<br />按位求反<br />逻辑非<br />删除属性<br />检测操作数类型<br />返回undefined值 | R<br />R<br />R<br />R<br />R<br />R<br />R<br />R<br />R | 1<br />1<br />1<br />1<br />1<br />1<br />1<br />1<br />1 | lval->num<br />lval->num<br />num->num<br />num->num<br />int->int<br />bool->bool<br />lval->lval<br />any->str<br />any->undef
* / % | 乘 除 求余 | L | 2 | num,num->num
+ -<br />+ | 加 减<br />字符串连接 | L<br />L | 2<br />2 | num,num->num<br />str,str->str
<<<br />>><br />>>> | 左移位<br />有符号右移位<br />无符号右移位 | L<br />L<br />L | 2<br />2<br />2 | int,int-int<br />int,int->int<br />int,int->int
< <= > >=<br />< <= > >=<br />instanceof<br />in | 比较数字顺序<br />比较在字母表中的顺序<br />测试对象类<br />测试属性是否存在 | L<br />L<br />L<br />L | 2<br />2<br />2<br />2 | num,num->bool<br />str,str->bool<br />obj,func->bool<br />str,obj->bool
==<br />!=<br />===<br />!== | 判断相等<br />判断不等<br />判断恒等<br />判断非恒等 | L<br />L<br />L<br />L | 2<br />2<br />2<br />2 | any,any->bool<br />any,any->bool<br />any,any->bool<br />any,any->bool
& | 按位与 | L | 2 | int,int->int
^ | 按位异或 | L | 2 | int,int->int
\| | 按位或 | L | 2 | int,int->int
&& | 逻辑与 | L | 2 | any,any-any
\|\| | 逻辑或 | L | 2 | any,any-any
?: | 条件运算符 | R | 3 | bool,any,any->any
=<br />*= /= %= += -= &= ^= \|= <<= >>= >>>= | 赋值<br />运算并赋值 | R<br />R | 2<br />2 | lval,any->any<br />lval,any->any
, | 逗号 | L | 2 | any,any->any

表中：
* 越靠前优先级越高
* A列表示结合性，L表示从左向右，R表示从右向左
* N列表示操作数的个数
* 类型列，->前表示操作数的类型，->后表示操作结果类型
* lval(left value)表示左值

### 4.7.1 操作数的个数

运算符根据需要的操作数的数量可分为三类：
* 一元操作符(Unary Operator)
* 二元操作符(Binary Operator)
* 三元操作符(Ternary Operator)

### 4.7.2 操作数类型和结果类型

一些运算符可以作用任何数据类型，介仍然希望它们的操作数是指定类型的数据，并且大多数运算符返回(或计算出)一个特定类型的值。JavaScript运算符通常会根据需要对操作数进行类型转换。

### 4.7.3 左值

左值(lvalue)指表达式只能出现在赋值运算符的左侧。在JavaScript中，变量、对象属性、数组元素都是左值。ECMAScript规范允许内置函数返回一个左值，但自定义函数则不能返回左值。

### 4.7.4 运算符的副作用

运算符的副作用是指执行完表达式后会对操作数进行修改。如`++`和`--`运算符会改变操作数的值。`delete`删除一个属性像给这个属性赋值undefined。

### 4.7.5 运算符的优先级

运算符的优先级控制着运算符的执行顺序。优先级高的运算符先执行，优先级低的运算符后执行。如：

```javascript
var w = 1 + 2 * 3;		// 7
```

由于*的优先级高于+，所以先计算乘法，再计算加法。如果不确定运算符的优先级，可以使用圆括号重写，始终会先计算括号里面的表达式。

### 4.7.6 运算符的结合性

运算符的结合性指定了在多个具有相同优先级的运算符表达式中运算顺序。如：

```javascript
var w = 6 - 2 + 1;		// 5
```

由于`-`和`+`具有相同的优先级，二者还都是左结合，所以从左向右计算。

### 4.7.7 运算顺序

运算符的优先级和结合性规定了它们在复杂表达式中的运算顺序，但并没有规定子表达式的计算过程中的顺序。JavaScript总是严格按照从左到右的顺序来计算表达式的值。

只有在任何一个表达式具有副作用而影响到其他表达式的时候，其求值顺序才会和看上去有所不同。如：

```javascript
var a = 1;
var b = a++ + a;		// b = 3;
```

虽然不提倡写出上述的代码，但是还是在明白表达式的求值的顺序。

## 4.8 算术表达式

### 4.8.1 "+"运算符

二元运算符"+"可以对两个数字做加法，也可以做字符串连接操作：

```javascript
1 + 2				// 3
"hello" + " world"	// "hello world"
"1" + "2"			// "12"
```

当两个操作数都是数字或者字符串时，计算结果是显而易见的。对于其他情况需要进行类型转换，加号首先考虑字符串连接，如果其中一个操作数是字符串或者转换为字符串的对象，另一个操作数也会转换为字符串，加号将进行字符串的连接。如果两个操作数都不是字符串的，那么将进行算术加法运算。具体如下：
* 如果其中一个操作数是对象，则对象会遵循对象到原始值的转换规则转换为原始值：日期对象通过toString()方法执行转换，其他对象通过valueOf()方法执行转换。由于多数对象都不具备可用的valueOf()方法。因此它们会通过toString()方法执行转换。由于多数对象都不具备可用的valueOf
* 在进行了对象到原始值的转换后，如果其中一个操作数是字符串的话，另一个操作数也会转换为字符串，然后进行字符串连接。
* 否则，两个操作数都将转换为数字，或者NaN，然后进行加法操作。

```javascript
1 + 2			// 3
"1" + "2" 		// "12"
"1" + 2			// "12"
1 + {}			// "1[object Object]"
true + true		// 2
1 + null		// 1
1 + undefined   // NaN

1 + 2 + " furzoom"	// "3 furzoom"
1 + (2 + " furzoom")// "12 furzoom"
```

注意结合性的影响。

### 4.8.2 一元算术运算符




Author website: [furzoom](http://furzoom.com/about-us/ "Furzoom")
